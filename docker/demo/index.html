<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini CLI Git Ask</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: #2563eb;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .form-container {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn-container {
            text-align: center;
            margin: 30px 0;
        }

        .btn-ask {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-weight: 500;
        }

        .btn-ask:hover {
            background: #1d4ed8;
        }

        .btn-ask:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 30px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-container {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #2563eb;
        }

        .result-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e5e9;
            padding-bottom: 10px;
        }

        .result-content {
            line-height: 1.7;
            color: #374151;
            font-size: 15px;
        }

        .result-content h1 {
            color: #1f2937;
            font-size: 28px;
            font-weight: 700;
            margin: 24px 0 16px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }

        .result-content h2 {
            color: #1f2937;
            font-size: 22px;
            font-weight: 600;
            margin: 20px 0 12px 0;
            padding-bottom: 6px;
            border-bottom: 1px solid #e5e7eb;
        }

        .result-content h3 {
            color: #1f2937;
            font-size: 18px;
            font-weight: 600;
            margin: 18px 0 10px 0;
        }

        .result-content h4, .result-content h5, .result-content h6 {
            color: #374151;
            font-weight: 600;
            margin: 16px 0 8px 0;
        }

        .result-content p {
            margin: 12px 0;
            line-height: 1.7;
        }

        .result-content ul, .result-content ol {
            margin: 12px 0;
            padding-left: 24px;
        }

        .result-content li {
            margin: 6px 0;
            line-height: 1.6;
        }

        .result-content ul ul, .result-content ol ol, 
        .result-content ul ol, .result-content ol ul {
            margin: 4px 0;
        }

        .result-content strong {
            color: #1f2937;
            font-weight: 600;
        }

        .result-content em {
            font-style: italic;
            color: #4b5563;
        }

        .result-content code {
            background: #f3f4f6;
            color: #dc2626;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Courier New', monospace;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid #e5e7eb;
        }

        .result-content pre {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 16px 0;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .result-content pre code {
            background: none;
            color: #1f2937;
            padding: 0;
            border: none;
            font-size: inherit;
        }

        .result-content blockquote {
            border-left: 4px solid #2563eb;
            margin: 20px 0;
            padding: 16px 20px;
            background: #f8fafc;
            border-radius: 0 6px 6px 0;
            color: #4b5563;
            font-style: italic;
        }

        .result-content blockquote p {
            margin: 0;
        }

        .result-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 14px;
        }

        .result-content th,
        .result-content td {
            border: 1px solid #e5e7eb;
            padding: 8px 12px;
            text-align: left;
        }

        .result-content th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .result-content tr:nth-child(even) {
            background: #f9fafb;
        }

        .result-content a {
            color: #2563eb;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s ease;
        }

        .result-content a:hover {
            border-bottom-color: #2563eb;
        }

        .result-content hr {
            border: none;
            height: 1px;
            background: #e5e7eb;
            margin: 24px 0;
        }

        .result-content img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            margin: 16px 0;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                max-width: 90%;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
                box-shadow: none;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 2em;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 1em;
            }

            .form-container {
                padding: 20px 15px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                font-size: 1em;
                margin-bottom: 6px;
            }

            .form-group input, .form-group textarea {
                padding: 12px;
                font-size: 16px; /* Prevent zoom on iOS */
            }

            .form-group textarea {
                min-height: 100px;
            }

            .btn-ask {
                width: 100%;
                padding: 15px;
                font-size: 16px;
            }

            .result-container {
                padding: 20px 15px;
                margin-top: 20px;
            }

            .result-title {
                font-size: 1.2em;
            }

            .result-content {
                font-size: 14px;
            }

            .result-content h1 {
                font-size: 24px;
                margin: 20px 0 12px 0;
            }

            .result-content h2 {
                font-size: 20px;
                margin: 16px 0 10px 0;
            }

            .result-content h3 {
                font-size: 16px;
                margin: 14px 0 8px 0;
            }

            .result-content pre {
                padding: 12px;
                font-size: 13px;
                overflow-x: auto;
            }

            .result-content table {
                font-size: 13px;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            .result-content th,
            .result-content td {
                padding: 6px 8px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }

            .header p {
                font-size: 0.9em;
            }

            .form-container {
                padding: 15px 10px;
            }

            .form-group input, .form-group textarea {
                padding: 10px;
            }

            .result-container {
                padding: 15px 10px;
            }

            .result-content {
                font-size: 13px;
            }

            .result-content h1 {
                font-size: 20px;
            }

            .result-content h2 {
                font-size: 18px;  
            }

            .result-content h3 {
                font-size: 16px;
            }

            .result-content pre, .result-content code {
                font-size: 12px;
            }

            .spinner {
                width: 40px;
                height: 40px;
            }
        }

        /* Desktop specific optimizations */
        @media (min-width: 1024px) {
            .container {
                max-width: 900px;
            }

            .form-container {
                padding: 50px;
            }

            .header {
                padding: 40px 50px;
            }

            .form-group input, .form-group textarea {
                font-size: 16px;
            }

            .btn-ask {
                padding: 15px 40px;
                font-size: 17px;
            }

            .result-container {
                padding: 40px 50px;
            }
        }

        /* Touch-friendly improvements */
        @media (pointer: coarse) {
            .btn-ask {
                min-height: 48px;
                padding: 15px 30px;
            }

            .form-group input, .form-group textarea {
                min-height: 48px;
            }
        }

        /* High-DPI screens */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .result-content img {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
                color: #e5e5e5;
            }

            .container {
                background: #2d2d2d;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            }

            .header {
                background: #1e40af;
            }

            .form-group input, .form-group textarea {
                background: #404040;
                border-color: #555;
                color: #e5e5e5;
            }

            .form-group input:focus, .form-group textarea:focus {
                border-color: #3b82f6;
                background: #4a4a4a;
            }

            .form-group label {
                color: #e5e5e5;
            }

            .result-container {
                background: #333;
                border-left-color: #3b82f6;
            }

            .result-title {
                color: #e5e5e5;
                border-bottom-color: #555;
            }

            .result-content {
                color: #d1d5db;
            }

            .result-content h1, .result-content h2, .result-content h3 {
                color: #f9fafb;
                border-bottom-color: #555;
            }

            .result-content code {
                background: #404040;
                color: #fbbf24;
                border-color: #555;
            }

            .result-content pre {
                background: #1f2937;
                border-color: #374151;
                color: #e5e7eb;
            }

            .result-content blockquote {
                background: #374151;
                border-left-color: #3b82f6;
                color: #d1d5db;
            }

            .result-content table th {
                background: #374151;
                color: #f9fafb;
            }

            .result-content table th, .result-content table td {
                border-color: #555;
            }

            .result-content table tr:nth-child(even) {
                background: #374151;
            }
        }


    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Gemini CLI Git Ask</h1>
            <p>Ask questions about any GitHub repository using AI</p>
        </div>

        <div class="form-container">
            <form id="askForm">
                <div class="form-group">
                    <label for="repoUrl">GitHub Repository URL</label>
                    <input type="url" id="repoUrl" name="repoUrl" placeholder="https://github.com/owner/repo" required>
                </div>

                <div class="form-group">
                    <label for="question">Your Question</label>
                    <textarea id="question" name="question" placeholder="What would you like to know about this repository?" required></textarea>
                </div>

                <div class="btn-container">
                    <button type="submit" class="btn-ask" id="askBtn">Ask AI Assistant</button>
                </div>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>AI is analyzing the repository and preparing your answer...</p>
            </div>

            <div class="result-container" id="resultContainer">
                <div class="result-title">AI Assistant Response</div>
                <div class="result-content" id="resultContent"></div>
            </div>
        </div>
    </div>

    <!-- Markdown parser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/16.0.0/lib/marked.umd.min.js" 
            onerror="this.onerror=null; this.src='https://unpkg.com/marked@16.0.0/lib/marked.umd.min.js'"></script>
    
    <script>
        // Example data with targeted questions for each project
        const examples = {
            'https://github.com/microsoft/vscode': [
                'How do I create and publish a VS Code extension?',
                'What are the key APIs available for VS Code extension development?',
                'How does VS Code handle language servers and LSP protocol?',
                'What is the architecture of VS Code\'s editor and workbench?',
                'How to debug VS Code extensions during development?',
                'VS Code 如何实现语法高亮和代码补全功能？',
                '如何为 VS Code 开发自定义主题？',
                'VS Code 的插件市场是如何工作的？'
            ],
            'https://github.com/facebook/react': [
                'What are React Hooks and how do they work internally?',
                'How does React\'s Virtual DOM reconciliation algorithm work?',
                'What is the difference between React.memo and useMemo?',
                'How does React\'s Fiber architecture improve performance?',
                'What are the best practices for React component composition?',
                'React 18 的并发特性是如何实现的？',
                'React 中的状态管理有哪些最佳实践？',
                'React 的服务端渲染是如何工作的？'
            ],
            'https://github.com/vuejs/vue': [
                'How does Vue\'s reactivity system work under the hood?',
                'What is the difference between Options API and Composition API?',
                'How does Vue\'s template compilation process work?',
                'What are Vue directives and how to create custom ones?',
                'How does Vue handle component lifecycle and optimization?',
                'Vue 3 相比 Vue 2 有哪些重大改进？',
                'Vue 的单文件组件是如何编译的？',
                'Vue 生态系统中的状态管理方案有哪些？'
            ],
            'https://github.com/angular/angular': [
                'How does Angular\'s dependency injection system work?',
                'What are Angular decorators and how do they function?',
                'How does Angular\'s change detection mechanism work?',
                'What is the Angular CLI and how does it generate code?',
                'How to implement lazy loading in Angular applications?',
                'Angular 的响应式表单是如何实现的？',
                'Angular 中的服务和模块是如何协作的？',
                'Angular 的测试框架和策略是什么？'
            ],
            'https://github.com/nodejs/node': [
                'How does Node.js event loop work internally?',
                'What is the difference between process.nextTick and setImmediate?',
                'How does Node.js handle asynchronous I/O operations?',
                'What are Node.js streams and how do they work?',
                'How does Node.js module system and require() work?',
                'Node.js 的内存管理和垃圾回收机制是怎样的？',
                'Node.js 中如何处理错误和异常？',
                'Node.js 的集群模式是如何实现的？' 
            ],
            'https://github.com/django/django': [
                'How does Django\'s ORM query optimization work?',
                'What is Django\'s MVT architecture and how does it differ from MVC?',
                'How does Django handle database migrations and schema changes?',
                'What are Django signals and when should they be used?',
                'How does Django\'s authentication and authorization system work?',
                'Django 的中间件机制是如何实现的？',
                'Django 中如何实现数据库事务管理？',
                'Django 的模板引擎有哪些特性和优化？'
            ],
            'https://github.com/kubernetes/kubernetes': [
                'How does Kubernetes scheduler decide pod placement?',
                'What is the architecture of Kubernetes control plane?',
                'How do Kubernetes controllers and operators work?',
                'What are Kubernetes Custom Resource Definitions (CRDs)?',
                'How does Kubernetes handle service discovery and networking?',
                'Kubernetes 的存储抽象和持久化是如何实现的？',
                'Kubernetes 中的自动扩缩容机制是怎样的？',
                'Kubernetes 的安全模型和 RBAC 是如何工作的？'
            ],
            'https://github.com/docker/docker-ce': [
                'How does Docker\'s layered filesystem work?',
                'What is the difference between Docker images and containers?',
                'How does Docker implement container isolation and security?',
                'What are Docker networks and how do they work?',
                'How does Docker handle resource management and limits?',
                'Docker 的镜像构建过程是怎样的？',
                'Docker 容器的生命周期管理是如何实现的？',
                'Docker 与虚拟机相比有哪些优势和劣势？'
            ],
            'https://github.com/tensorflow/tensorflow': [
                'How does TensorFlow\'s automatic differentiation work?',
                'What is the difference between TensorFlow 1.x and 2.x execution models?',
                'How does TensorFlow handle distributed training across multiple GPUs?',
                'What are TensorFlow operations and how are they optimized?',
                'How does TensorFlow\'s SavedModel format work?',
                'TensorFlow 的计算图是如何构建和优化的？',
                '如何在 TensorFlow 中实现自定义操作和层？',
                'TensorFlow 的模型部署策略有哪些？'
            ],
            'https://github.com/pytorch/pytorch': [
                'How does PyTorch\'s dynamic computation graph work?',
                'What is the difference between PyTorch tensors and NumPy arrays?',
                'How does PyTorch implement automatic gradient computation?',
                'What are PyTorch DataLoaders and how do they optimize data loading?',
                'How does PyTorch handle GPU memory management?',
                'PyTorch 的模型保存和加载机制是怎样的？',
                'PyTorch 中如何实现自定义损失函数？',
                'PyTorch 的分布式训练是如何实现的？'
            ],
            'https://github.com/google-gemini/gemini-cli': [
                'How does this CLI tool integrate with the Gemini API?',
                'What authentication methods does this tool support?',
                'How does the tool handle different input formats and models?',
                'What are the key configuration options for the Gemini CLI?',
                'How does the tool manage API rate limits and errors?',
                '这个 CLI 工具支持哪些 Gemini 模型？',
                '如何配置和使用这个命令行工具？',
                '这个工具的主要使用场景和优势是什么？'
            ]
        };

        function getRandomRepo() {
            const repos = Object.keys(examples);
            return repos[Math.floor(Math.random() * repos.length)];
        }

        function getRandomQuestionForRepo(repoUrl) {
            const questions = examples[repoUrl];
            if (questions && questions.length > 0) {
                return questions[Math.floor(Math.random() * questions.length)];
            }
            // Fallback to a generic question if repo not found
            return 'What is this project about and what problem does it solve?';
        }

        function updateQuestionForRepo(repoUrl) {
            const questionField = document.getElementById('question');
            if (!questionField.value || questionField.dataset.wasAutoFilled === 'true') {
                questionField.value = getRandomQuestionForRepo(repoUrl);
                questionField.dataset.wasAutoFilled = 'true';
            }
        }

        // Set random examples when clicking input fields
        document.getElementById('repoUrl').addEventListener('focus', function() {
            if (!this.value) {
                this.value = getRandomRepo();
                updateQuestionForRepo(this.value);
            }
        });

        // Update question when repo URL changes
        document.getElementById('repoUrl').addEventListener('change', function() {
            updateQuestionForRepo(this.value);
        });

        document.getElementById('repoUrl').addEventListener('blur', function() {
            updateQuestionForRepo(this.value);
        });

        document.getElementById('question').addEventListener('focus', function() {
            const repoUrl = document.getElementById('repoUrl').value;
            if (!this.value) {
                this.value = getRandomQuestionForRepo(repoUrl);
                this.dataset.wasAutoFilled = 'true';
            }
        });

        document.getElementById('question').addEventListener('input', function() {
            // Mark as user-edited when user types
            this.dataset.wasAutoFilled = 'false';
        });

        // Set initial random examples
        window.addEventListener('load', function() {
            const randomRepo = getRandomRepo();
            document.getElementById('repoUrl').value = randomRepo;
            const questionField = document.getElementById('question');
            questionField.value = getRandomQuestionForRepo(randomRepo);
            questionField.dataset.wasAutoFilled = 'true';
        });

        // Form submission
        document.getElementById('askForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const repoUrl = document.getElementById('repoUrl').value.trim();
            const question = document.getElementById('question').value.trim();
            
            if (!repoUrl || !question) {
                alert('Please fill in both repository URL and question.');
                return;
            }

            // Show loading state
            document.getElementById('askBtn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultContainer').style.display = 'none';

            try {
                const response = await fetch('/api/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        repository_url: repoUrl,
                        question: question
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                
                // Show result
                const resultContent = document.getElementById('resultContent');
                if (data.answer) {
                    resultContent.innerHTML = marked.parse(data.answer);
                } else if (data.error) {
                    resultContent.innerHTML = `<div style="color: #d32f2f; padding: 15px; background: #ffebee; border-radius: 6px;"><strong>Error:</strong> ${data.error}</div>`;
                } else {
                    resultContent.innerHTML = '<div style="color: #f57c00; padding: 15px; background: #fff3e0; border-radius: 6px;">No answer received from the AI assistant.</div>';
                }
                
                document.getElementById('resultContainer').style.display = 'block';
                
                // Scroll to result
                document.getElementById('resultContainer').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });

            } catch (error) {
                console.error('Error:', error);
                
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                
                // Show error
                document.getElementById('resultContent').innerHTML = `
                    <div style="color: #d32f2f; padding: 15px; background: #ffebee; border-radius: 6px;">
                        <strong>Error:</strong> Failed to get response from AI assistant. Please try again later.
                        <br><small>Details: ${error.message}</small>
                    </div>
                `;
                document.getElementById('resultContainer').style.display = 'block';
            } finally {
                // Re-enable button
                document.getElementById('askBtn').disabled = false;
            }
        });
    </script>
</body>
</html> 